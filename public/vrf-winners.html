<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>âš¡ SOL STIMULUS | VRF Winners</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* === Winner Table Specific Styles === */
    .winner-table-section {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-2xl);
      padding: var(--space-8);
      max-width: min(1200px, 95vw);
      margin: var(--space-10) auto;
      box-shadow: var(--shadow-card), var(--shadow-glow);
      overflow-x: auto;
      position: relative;
    }

    .winner-table-section::before {
      content: "$ ./query_winners.sh --verify-all";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: var(--bg-elevated);
      color: var(--sol-green);
      font-family: var(--font-mono);
      font-size: var(--text-xs);
      padding: var(--space-2) var(--space-4);
      border-bottom: 1px solid var(--border-dim);
      border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
    }

    .winner-table-section h2 {
      color: var(--sol-purple);
      text-shadow: var(--shadow-glow);
      margin-bottom: var(--space-6);
      margin-top: var(--space-6);
      font-size: var(--text-2xl);
      text-align: center;
      font-family: var(--font-display);
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      color: var(--text-secondary);
      text-align: center;
      font-size: var(--text-sm);
      font-family: var(--font-mono);
      background: var(--bg-terminal);
      border-radius: var(--radius-lg);
      overflow: hidden;
      min-width: 700px;
    }

    thead {
      background: var(--bg-elevated);
      border-bottom: 2px solid var(--border-primary);
    }

    th,
    td {
      padding: var(--space-4) var(--space-3);
      border-bottom: 1px solid var(--border-dim);
    }

    th {
      color: var(--sol-green);
      font-weight: var(--font-bold);
      text-shadow: var(--shadow-glow-green);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: var(--text-xs);
    }

    tr:hover td {
      background: var(--bg-elevated);
      color: var(--text-primary);
      transition: var(--transition-all);
    }

    .vrf-link,
    .tx-link {
      color: var(--sol-green);
      text-decoration: none;
      transition: var(--transition-all);
      font-weight: var(--font-semibold);
      position: relative;
    }

    .vrf-link::before {
      content: "ðŸ“„ ";
    }

    .tx-link::before {
      content: "ðŸ”— ";
    }

    .vrf-link:hover,
    .tx-link:hover {
      color: var(--sol-blue);
      text-shadow: 0 0 10px rgba(0, 212, 255, 0.8);
      text-decoration: underline;
    }

    /* Table responsive wrapper */
    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      border-radius: var(--radius-lg);
    }

    .table-wrapper::-webkit-scrollbar {
      height: 8px;
    }

    .table-wrapper::-webkit-scrollbar-track {
      background: var(--bg-darker);
      border-radius: var(--radius-md);
    }

    .table-wrapper::-webkit-scrollbar-thumb {
      background: var(--sol-purple);
      border-radius: var(--radius-md);
    }

    .table-wrapper::-webkit-scrollbar-thumb:hover {
      background: var(--sol-green);
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: var(--space-10);
      color: var(--text-muted);
      font-family: var(--font-mono);
    }

    .empty-state::before {
      content: "âš ";
      display: block;
      font-size: var(--text-3xl);
      margin-bottom: var(--space-4);
      color: var(--warning);
    }

    /* Stats summary */
    .stats-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
      margin-bottom: var(--space-6);
      margin-top: var(--space-6);
    }

    .stat-card {
      background: var(--bg-terminal);
      border: 1px solid var(--border-dim);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      text-align: center;
      transition: var(--transition-all);
    }

    .stat-card:hover {
      border-color: var(--border-glow);
      transform: translateY(-2px);
    }

    .stat-label {
      color: var(--text-muted);
      font-size: var(--text-xs);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: var(--space-2);
      font-family: var(--font-mono);
    }

    .stat-value {
      color: var(--sol-purple);
      font-size: var(--text-2xl);
      font-weight: var(--font-bold);
      font-family: var(--font-mono);
      text-shadow: var(--shadow-glow);
    }

    /* Pagination styles are inherited from main style.css */
  </style>
</head>

<body>
<!-- === Terminal Scanline Effect === -->
<div class="scanline"></div>

<!-- === Canvas for Particle Effects === -->
<canvas id="lanternCanvas"></canvas>

<!-- === HEADER === -->
<header class="top-header">
  <div class="logo">
    SOL STIMULUS
  </div>

  <div id="contract-address" class="contract-address">
    Loading contract address...
  </div>

  <button id="menu-toggle" class="menu-toggle" aria-label="Toggle Menu">
    <span></span>
    <span></span>
    <span></span>
  </button>

  <nav class="nav">
    <a href="index.html" class="nav-link">Home</a>
    <a href="lobby.html" class="nav-link">Terminal Lobby</a>
    <a href="faq.html" class="nav-link">FAQ</a>
    <a href="vrf-winners.html" class="nav-link" style="color: var(--sol-green);">VRF Winners</a>
    <a
      href="https://solscan.io/account/VRFzZoJdhFWL8rkvu87LpKM3RbcVezpMEc6X5GVDr7y#cards"
      class="nav-link highlight"
      target="_blank"
      rel="noopener noreferrer"
    >
      VRF Contract
    </a>
  </nav>
</header>

<!-- === HERO === -->
<section class="hero">
  <h1>VERIFIABLE RANDOM WINNERS</h1>
  <p class="subtitle">
    All results are cryptographically verified using <strong>Solana VRF</strong> â€” ensuring transparent, provably fair draws.
  </p>
</section>

<!-- === WINNERS TABLE === -->
<section class="winner-table-section">
  <h2>Verified Winner History</h2>

  <!-- Stats Summary -->
  <div class="stats-summary">
    <div class="stat-card">
      <div class="stat-label">Total Winners</div>
      <div class="stat-value" id="total-winners">0</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Total Distributed</div>
      <div class="stat-value" id="total-distributed">0 SOL</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">Last Draw</div>
      <div class="stat-value" id="last-draw" style="font-size: var(--text-base);">Loading...</div>
    </div>
  </div>

  <div class="table-wrapper">
    <table id="winners-table">
      <thead>
        <tr>
          <th>Pool</th>
          <th>Wallet Address</th>
          <th>Amount</th>
          <th>VRF Proof</th>
          <th>Transaction</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="6" class="empty-state">Loading winner data...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination controls -->
  <div id="pagination" class="pagination"></div>
</section>

<footer>
  <p>Â© 2025 SOL STIMULUS â€” Built on Solana Blockchain</p>
  <div class="disclaimer">
    <p><strong>DISCLAIMER</strong></p>
    <p>Not a lottery or state-regulated gambling service. For entertainment purposse</p>
  </div>
</footer>

<script>
  // Load contract address
  fetch('/api/contract')
    .then(res => res.json())
    .then(data => {
      document.getElementById('contract-address').textContent = data.address || 'No contract address set';
    })
    .catch(() => {
      document.getElementById('contract-address').textContent = 'Failed to load contract';
    });

  // Mobile menu toggle
  const menuToggle = document.getElementById('menu-toggle');
  const nav = document.querySelector('.nav');

  menuToggle.addEventListener('click', () => {
    nav.classList.toggle('active');
    menuToggle.classList.toggle('open');
  });

  // Winner data loading
  async function loadWinners() {
    try {
      const res = await fetch('winner.json?_=' + Date.now()); // prevent caching
      const winners = await res.json();

      // Update stats
      document.getElementById('total-winners').textContent = winners.length;

      let totalAmount = 0;
      winners.forEach(w => {
        const amount = parseFloat(w.amount) || 0;
        totalAmount += amount;
      });
      document.getElementById('total-distributed').textContent = totalAmount.toFixed(2) + ' SOL';

      if (winners.length > 0) {
        const lastWinner = winners[0];
        document.getElementById('last-draw').textContent = lastWinner.date || 'N/A';
      } else {
        document.getElementById('last-draw').textContent = 'No draws yet';
      }

      setupPagination(winners);
    } catch (err) {
      console.error('Error loading winners:', err);
      const tableBody = document.querySelector('#winners-table tbody');
      tableBody.innerHTML = '<tr><td colspan="6" class="empty-state">Failed to load winner data</td></tr>';
    }
  }

  function setupPagination(winners) {
    const rowsPerPage = 10;
    const pageCount = Math.ceil(winners.length / rowsPerPage);
    let currentPage = 1;

    const pagination = document.getElementById('pagination');
    const tableBody = document.querySelector('#winners-table tbody');

    function displayPage(page) {
      tableBody.innerHTML = '';
      const start = (page - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = winners.slice(start, end);

      if (pageData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="6" class="empty-state">No winners found</td></tr>';
        return;
      }

      pageData.forEach(winner => {
        const row = document.createElement('tr');

        // Format wallet address (shorten for display)
        const wallet = winner.wallet || 'N/A';
        const shortWallet = wallet.length > 16
          ? wallet.substring(0, 8) + '...' + wallet.substring(wallet.length - 6)
          : wallet;

        row.innerHTML = `
          <td><strong style="color: var(--sol-purple);">${winner.pool || 'Unknown Pool'}</strong></td>
          <td title="${wallet}">${shortWallet}</td>
          <td><strong style="color: var(--sol-green);">${winner.amount || '0.0 SOL'}</strong></td>
          <td><a href="/VRF/${winner.vrf}" class="vrf-link" target="_blank">Proof</a></td>
          <td><a href="${winner.tx || '#'}" class="tx-link" target="_blank" rel="noopener">Hash</a></td>
          <td>${winner.date || 'N/A'}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    function renderPagination() {
      pagination.innerHTML = '';
      if (pageCount <= 1) return; // Don't show pagination if only 1 page

      for (let i = 1; i <= pageCount; i++) {
        const button = document.createElement('button');
        button.textContent = i;
        button.className = i === currentPage ? 'active' : '';
        button.addEventListener('click', () => {
          currentPage = i;
          displayPage(currentPage);
          renderPagination();
          // Scroll to top of table
          document.querySelector('.winner-table-section').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        });
        pagination.appendChild(button);
      }
    }

    displayPage(currentPage);
    renderPagination();
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadWinners();
    // Auto-refresh every 60 seconds
    setInterval(loadWinners, 60000);
  });
</script>

<script src="script.js"></script>
</body>
</html>
